<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Ternary Values Survey â€“ Equality, Innovation, Ethics</title>
  <style>
    :root { --bg:#0b1020; --card:#121832; --ink:#eaf0ff; --muted:#a9b4d0; --accent:#7aa2ff; --ok:#41c982; }
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; color:var(--ink); background:linear-gradient(180deg,#0a0f20,#050713 80%); }
    .wrap { max-width:960px; margin:32px auto; padding:0 16px; }
    .card { background:linear-gradient(180deg,#151b36,#0f1430); border:1px solid #20274a; border-radius:20px; padding:20px; box-shadow:0 10px 40px rgba(0,0,0,.35); }
    h1,h2 { margin:0 0 6px 0; }
    h1 { font-size:28px; letter-spacing:.3px; }
    h2 { font-size:20px; color:var(--ink); opacity:.95; margin-top:16px; }
    p,li,small { color:var(--muted); }
    .row { display:grid; grid-template-columns:1fr; gap:16px; }
    @media(min-width:900px){ .row{ grid-template-columns:1fr 1fr; } }
    .tri { position:relative; aspect-ratio:1.05/1; background:radial-gradient(ellipse at top,#18224a 0%,#0e1330 60%); border-radius:16px; border:1px solid #243062; }
    .hud { position:absolute; inset:10px; display:flex; flex-direction:column; justify-content:space-between; pointer-events:none; }
    .labels { display:flex; justify-content:space-between; font-weight:600; }
    .label { color:#dfe6ff; text-shadow:0 2px 12px rgba(0,0,0,.6); }
    .vals { display:flex; gap:10px; flex-wrap:wrap; font-feature-settings:"tnum" 1; }
    .vals span { background:#0f1636; border:1px solid #22306a; border-radius:999px; padding:6px 10px; }
    canvas { width:100%; height:100%; display:block; border-radius:16px; }
    .footer { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    input,button { font:inherit; border-radius:12px; border:1px solid #33407a; background:#0e1433; color:var(--ink); padding:10px 12px; }
    input::placeholder{ color:#7d89b3; }
    button { cursor:pointer; background:linear-gradient(180deg,#26347a,#1a265e); border-color:#2e3c84; font-weight:700; }
    button.primary { background:linear-gradient(180deg,#4b7bff,#3d69e8); border-color:#5581ff; }
    .ok { color:var(--ok); font-weight:600; }
    .err { color:#ff6b7a; font-weight:600; }
    .tiny { font-size:12px; opacity:.9; }
    .muted { color:var(--muted); }
    .grid { display:grid; gap:16px; }
  </style>
</head>
<body>
  <div class="wrap grid">
    <div class="card">
      <h1>How should society balance these values?</h1>
      <p>Place one dot on each triangle to show the relative importance society gives these three values <em>now</em> and what you think it will value in <strong>2075</strong>. The three percentages always add to 100.</p>
      <ul>
        <li><strong>Drag</strong> the dot or <strong>click</strong> inside the triangle.</li>
        <li>Enter your <strong>UCD email</strong> (one submission per email).</li>
      </ul>
    </div>

    <!-- PRESENT -->
    <div class="card">
      <h2>Present (2025)</h2>
      <div id="present" class="tri">
        <canvas id="canvas-present"></canvas>
        <div class="hud">
          <div class="labels"><span class="label" id="la">Equality</span><span class="label" id="lb">Innovation</span></div>
          <div class="vals">
            <span id="pa">Eq: <b>34</b>%</span>
            <span id="pb">Inn: <b>33</b>%</span>
            <span id="pc">Eth: <b>33</b>%</span>
          </div>
          <div class="labels" style="justify-content:center"><span class="label" id="lc">Ethics</span></div>
        </div>
      </div>
    </div>

    <!-- FUTURE -->
    <div class="card">
      <h2>Year 2075</h2>
      <div id="future" class="tri">
        <canvas id="canvas-future"></canvas>
        <div class="hud">
          <div class="labels"><span class="label">Equality</span><span class="label">Innovation</span></div>
          <div class="vals">
            <span id="fa">Eq: <b>34</b>%</span>
            <span id="fb">Inn: <b>33</b>%</span>
            <span id="fc">Eth: <b>33</b>%</span>
          </div>
          <div class="labels" style="justify-content:center"><span class="label">Ethics</span></div>
        </div>
      </div>
    </div>

    <!-- FORM -->
    <div class="card">
      <h2>Submit</h2>
      <div class="grid">
        <label>Email (UCD): <br/><input type="email" id="email" placeholder="firstname.lastname@ucd.ie" required/></label>
        <div class="footer">
          <button id="reset">Reset dots</button>
          <button id="submit" class="primary">Submit once</button>
          <span id="status" class="tiny"></span>
        </div>
      </div>
    </div>
  </div>

<script>
/** ======= QUICK SETTINGS ======= */
const VALUE_A = "Equality";
const VALUE_B = "Innovation";
const VALUE_C = "Ethics";
/** ======= END SETTINGS ======= */
const ENDPOINT = "https://script.google.com/macros/s/AKfycbwIxoLmOuRI6oYsa4t96uU23lgn94El2KR01spjlB0CYoWPnOFJaNMADK-x61fJk6Nu/exec";

/* --- tiny ternary plot engine --- */
class Ternary {
  constructor(rootId, readoutIds) {
    this.root = document.getElementById(rootId);
    this.canvas = this.root.querySelector('canvas');
    this.ctx = this.canvas.getContext('2d');
    this.readout = readoutIds.map(id => document.getElementById(id));
    this.weights = [0.34,0.33,0.33];
    this.resizeObserver = new ResizeObserver(() => this.fit());
    this.resizeObserver.observe(this.root);
    this.canvas.addEventListener('pointerdown', e=>this.drag(e));
    this.canvas.addEventListener('pointermove', e=>{ if(e.buttons===1) this.drag(e); });
    this.canvas.addEventListener('click', e=>this.drag(e));
    setTimeout(()=>this.fit(),0);
  }
  geom(){const r=this.root.getBoundingClientRect(),pad=20,s=Math.min(r.width-2*pad,r.height-2*pad),cx=r.width/2,top=(r.height-s)/2,h=s*Math.sqrt(3)/2;return{A:{x:cx-s/2,y:top+h},B:{x:cx+s/2,y:top+h},C:{x:cx,y:top}};}
  fit(){const dpr=window.devicePixelRatio||1,r=this.root.getBoundingClientRect();this.canvas.width=r.width*dpr;this.canvas.height=r.height*dpr;this.ctx.setTransform(dpr,0,0,dpr,0,0);this.draw();}
  draw(){const{A,B,C}=this.geom(),ctx=this.ctx;ctx.clearRect(0,0,this.canvas.width,this.canvas.height);ctx.beginPath();ctx.moveTo(A.x,A.y);ctx.lineTo(B.x,B.y);ctx.lineTo(C.x,C.y);ctx.closePath();ctx.fillStyle='#0e1638';ctx.fill();ctx.strokeStyle='#253066';ctx.stroke();const P=this.baryToXY(this.weights);ctx.fillStyle='#7aa2ff';ctx.beginPath();ctx.arc(P.x,P.y,7,0,Math.PI*2);ctx.fill();const[a,b,c]=this.weights.map(v=>Math.round(v*100));this.readout[0].innerHTML=`Eq: <b>${a}</b>%`;this.readout[1].innerHTML=`Inn: <b>${b}</b>%`;this.readout[2].innerHTML=`Eth: <b>${c}</b>%`;}
  baryToXY([u,v,w]){const{A,B,C}=this.geom();return{x:u*A.x+v*B.x+w*C.x,y:u*A.y+v*B.y+w*C.y};}
  clamp(px,py){const{A,B,C}=this.geom(),v0={x:B.x-A.x,y:B.y-A.y},v1={x:C.x-A.x,y:C.y-A.y},v2={x:px-A.x,y:py-A.y},d00=v0.x*v0.x+v0.y*v0.y,d01=v0.x*v1.x+v0.y*v1.y,d11=v1.x*v1.x+v1.y*v1.y,d20=v2.x*v0.x+v2.y*v0.y,d21=v2.x*v1.x+v2.y*v1.y,den=d00*d11-d01*d01,v=(d11*d20-d01*d21)/den,w=(d00*d21-d01*d20)/den,u=1-v-w,s=u+v+w||1;return[Math.max(0,u)/s,Math.max(0,v)/s,Math.max(0,w)/s];}
  drag(e){const r=this.canvas.getBoundingClientRect();const[x,y]=[e.clientX-r.left,e.clientY-r.top];this.weights=this.clamp(x,y);this.draw();}
  get percents(){return this.weights.map(v=>Math.round(v*100));}
  reset(){this.weights=[0.34,0.33,0.33];this.draw();}
}
const p=new Ternary("present",["pa","pb","pc"]);
const f=new Ternary("future",["fa","fb","fc"]);

document.getElementById("reset").onclick=()=>{p.reset();f.reset();document.getElementById("status").textContent="";};
document.getElementById("submit").onclick=async()=>{
  const email=document.getElementById("email").value.trim();
  const status=document.getElementById("status");
  if(!/@/.test(email)){status.innerHTML='<span class="err">Enter a valid email.</span>';return;}
  status.textContent="Submitting...";
  try{
    const body={email,present:{e:p.percents[0],c:p.percents[1],env:p.percents[2]},future:{e:f.percents[0],c:f.percents[1],env:f.percents[2]}};
    const res=await fetch(ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)});
    const data=await res.json();
    if(res.ok){status.innerHTML='<span class="ok">Saved. Thanks!</span>';}else{status.innerHTML='<span class="err">'+(data.error||"Error")+'</span>';}
  }catch(err){status.innerHTML='<span class="err">'+err.message+'</span>';}
};
</script>
</body>
</html>
